USE [DBPREDICTIVO]
GO
/****** Object:  StoredProcedure [dbo].[sp_Consolidar_Ventas]    Script Date: 15/09/2020 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[sp_Consolidar_Ventas]
-- @fechaInicio datetime,
 --@fechaFin datetime
 AS
WITH Ventas (DIA,CODIGO,TOTAL) AS
(
select (CASE WHEN FECHA_MOV='01-08-2019' THEN 'DIA1'
             WHEN FECHA_MOV=(SELECT (DATEADD(DAY,1,'01-08-2019'))) THEN 'DIA2'
			 WHEN FECHA_MOV=(DATEADD(DAY,2,'01-08-2019')) THEN 'DIA3'
			 WHEN FECHA_MOV=(DATEADD(DAY,3,'01-08-2019')) THEN 'DIA4'
			 WHEN FECHA_MOV=(DATEADD(DAY,4,'01-08-2019')) THEN 'DIA5'
			 WHEN FECHA_MOV=(DATEADD(DAY,5,'01-08-2019')) THEN 'DIA6'
			 WHEN FECHA_MOV=(DATEADD(DAY,6,'01-08-2019')) THEN 'DIA7'
			 WHEN FECHA_MOV=(DATEADD(DAY,4,'01-08-2019')) THEN 'DIA8'
			 WHEN FECHA_MOV=(DATEADD(DAY,8,'01-08-2019')) THEN 'DIA9'
			  WHEN FECHA_MOV=(DATEADD(DAY,9,'01-08-2019')) THEN 'DIA10'
		     WHEN FECHA_MOV=(DATEADD(DAY,10,'01-08-2019')) THEN 'DIA11' END)
,FK_MAESTRO_ARTICULOS,isnull(sum(CANTIDADES*-1),0) AS 'UND_VENDIDAS' from kardex 
where FECHA_MOV between '2019-08-01' and '2019-08-10'
and FK_ALMACEN=170000002 and DESCRIP_MOV='VENTA MINORISTA'
GROUP BY FK_MAESTRO_ARTICULOS,FECHA_MOV
) 
Select * from Ventas
PIVOT (SUM(TOTAL) FOR DIA IN ([DIA1],[DIA2],[DIA3],[DIA4],[DIA5],[DIA6],[DIA7],[DIA8],[DIA9],[DIA10],[DIA11])) PVT
